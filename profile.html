<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>NearLove - Há»“ sÆ¡</title>

<style>
  body { font-family: Arial; padding:20px; background:#f9f9f9; }
  h2 { text-align:center; }
  .input {
    width:100%; padding:12px; margin:8px 0;
    border-radius:10px; border:1px solid #ccc;
  }
  .btn {
    width:100%; padding:14px;
    border:none; border-radius:10px;
    background:#ff2e73; color:white; font-weight:bold;
    margin-top:10px; font-size:16px;
  }
  #msg { margin-top:10px; font-size:14px; }
</style>

</head>

<body>

<h2>Há»“ sÆ¡ cÃ¡ nhÃ¢n ğŸ’—</h2>

<!-- Form há»“ sÆ¡ -->
<input id="name" class="input" placeholder="TÃªn hiá»ƒn thá»‹">
<input id="age" class="input" placeholder="Tuá»•i">
<input id="gender" class="input" placeholder="Giá»›i tÃ­nh (Nam/Ná»¯/KhÃ¡c)">
<input id="bio" class="input" placeholder="Giá»›i thiá»‡u báº£n thÃ¢n">

<button class="btn" onclick="saveProfile()">LÆ°u há»“ sÆ¡</button>

<p id="msg"></p>

<hr style="margin:20px 0;">

<h3>ThÃ´ng tin Ä‘Ã£ lÆ°u:</h3>
<p><b>TÃªn:</b> <span id="d_name"></span></p>
<p><b>Tuá»•i:</b> <span id="d_age"></span></p>
<p><b>Giá»›i tÃ­nh:</b> <span id="d_gender"></span></p>
<p><b>MÃ´ táº£:</b> <span id="d_bio"></span></p>

<!-- Firebase -->
<script type="module" src="firebase.js"></script>

<!-- Code Firestore -->
<script type="module">
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  import {
    doc, setDoc, getDoc
  } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  const msg = document.getElementById("msg");

  // Láº¥y UID ngÆ°á»i Ä‘Äƒng nháº­p
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      alert("Báº¡n chÆ°a Ä‘Äƒng nháº­p. Chuyá»ƒn vá» trang login.");
      window.location.href = "login.html";
      return;
    }

    const uid = user.uid;

    // Load há»“ sÆ¡
    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);

    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("d_name").innerText = data.name || "";
      document.getElementById("d_age").innerText = data.age || "";
      document.getElementById("d_gender").innerText = data.gender || "";
      document.getElementById("d_bio").innerText = data.bio || "";

      // GÃ¡n ngÆ°á»£c lÃªn input (edit)
      name.value = data.name || "";
      age.value = data.age || "";
      gender.value = data.gender || "";
      bio.value = data.bio || "";
    }
  });

  // LÆ°u há»“ sÆ¡
  window.saveProfile = async () => {
    const user = auth.currentUser;

    if (!user) return alert("ChÆ°a Ä‘Äƒng nháº­p!");

    const uid = user.uid;

    const data = {
      name: name.value,
      age: age.value,
      gender: gender.value,
      bio: bio.value,
    };

    try {
      await setDoc(doc(db, "users", uid), data, { merge: true });

      msg.style.color = "green";
      msg.innerText = "ÄÃ£ lÆ°u há»“ sÆ¡ thÃ nh cÃ´ng!";

      // Hiá»ƒn thá»‹ láº¡i
      d_name.innerText = data.name;
      d_age.innerText = data.age;
      d_gender.innerText = data.gender;
      d_bio.innerText = data.bio;

    } catch (err) {
      msg.style.color = "red";
      msg.innerText = err.message;
    }
  }
</script>

</body>
</html>
