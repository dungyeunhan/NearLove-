<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>NearLove - Home</title>
<link rel="stylesheet" href="theme.css">
<style>
  .quick{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
  @media(max-width:700px){.quick{grid-template-columns:repeat(2,1fr);}}
  .stat{display:flex;justify-content:space-between;margin-top:4px;}
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ‘‹ ChÃ o má»«ng quay láº¡i, <span id="meName">...</span></h2>

  <!-- TÃ³m táº¯t -->
  <div class="box">
    <div class="stat"><span>ğŸ’° Xu</span><b id="meCoins">0</b></div>
    <div class="stat"><span>ğŸ‘‘ VIP</span><b id="meVip">0</b></div>
    <div class="stat"><span>ğŸ‘— Style</span><b id="meStyle">0</b></div>
    <div class="stat"><span>âœˆï¸ Du lá»‹ch</span><b id="meTrips">0 chuyáº¿n</b></div>
    <div class="stat"><span>ğŸ° Bang</span><b id="meGuild">ChÆ°a vÃ o</b></div>
    <div class="stat"><span>ğŸ¾ Pet</span><b id="mePet">ChÆ°a cÃ³</b></div>
    <div class="stat"><span>ğŸ  NhÃ </span><b id="meHouse">ChÆ°a cÃ³</b></div>
  </div>

  <!-- Quick actions -->
  <div class="box" style="margin-top:10px;">
    <div style="font-weight:900;margin-bottom:8px;">âš¡ ChÆ¡i nhanh</div>
    <div class="quick">
      <a class="card btn light" href="explore.html">ğŸ’ Explore</a>
      <a class="card btn light" href="match.html">ğŸ”¥ Match</a>
      <a class="card btn light" href="chat.html">ğŸ’¬ Chat</a>
      <a class="card btn light" href="farm.html">ğŸŒ¾ Farm</a>
      <a class="card btn light" href="pet_race.html">ğŸ¾ Pet Race</a>
      <a class="card btn light" href="house_decor.html">ğŸ  Decor</a>
      <a class="card btn light" href="fashion.html">ğŸ‘— Fashion</a>
      <a class="card btn light" href="gacha.html">ğŸ Gacha</a>
      <a class="card btn light" href="travel.html">âœˆï¸ Travel</a>
      <a class="card btn light" href="leaderboard.html">ğŸ† BXH</a>
      <a class="card btn light" href="guild.html">ğŸ° Bang</a>
      <a class="card btn light" href="wedding.html">ğŸ’ HÃ´n lá»…</a>
    </div>
  </div>
</div>

<script type="module" src="firebase.js"></script>
<script src="theme.js"></script>

<script type="module">
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  const $=id=>document.getElementById(id);

  onAuthStateChanged(auth, async (user)=>{
    if(!user){ location.href="login.html"; return; }

    const uid=user.uid;

    // users
    const uSnap=await getDoc(doc(db,"users",uid));
    const u=uSnap.exists()?uSnap.data():{};
    $("meName").innerText=u.name||"Báº¡n";
    $("meCoins").innerText=u.coins||0;
    $("meVip").innerText=u.vipTier||0;
    $("meGuild").innerText=u.guildId?`${u.guildBadge||"ğŸ°"} ${u.guildName||""}`:"ChÆ°a vÃ o";
    $("mePet").innerText=u.activePet?`${u.activePet.icon||"ğŸ¾"} ${u.activePet.name} Lv.${u.activePet.level||1}`:"ChÆ°a cÃ³";
    $("meHouse").innerText=u.activeHouse?`${u.activeHouse.icon||"ğŸ "} ${u.activeHouse.name} Lv.${u.activeHouse.level||1}`:"ChÆ°a cÃ³";

    // wardrobe style
    const wSnap=await getDoc(doc(db,"wardrobe",uid));
    $("meStyle").innerText=wSnap.exists()?(wSnap.data().stylePoints||0):0;

    // travel trips
    const tSnap=await getDoc(doc(db,"travels",uid));
    $("meTrips").innerText=tSnap.exists()?`${tSnap.data().totalTrips||0} chuyáº¿n`:"0 chuyáº¿n";
  });
</script>

<script type="module">
  import { renderNav } from "./nav.js";
  import { requireAuth } from "./guard.js";
  requireAuth();
  renderNav("home");
</script>

</body>
</html>
