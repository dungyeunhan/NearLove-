<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>NearLove - Mini Game kiáº¿m xu</title>

<style>
  body{
    font-family:Arial;background:#0f1115;color:white;
    padding:16px;padding-bottom:80px;text-align:center;
  }
  h2{color:#ffd1e6;margin-top:6px;}
  .box{
    max-width:520px;margin:14px auto;background:#151824;
    padding:16px;border-radius:16px;border:1px solid rgba(255,255,255,0.06);
  }
  .coins{font-size:18px;font-weight:bold;margin:8px 0;}
  .heart{
    width:200px;height:200px;margin:12px auto;border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #ff8ac9, #ff2e73);
    display:grid;place-items:center;font-size:70px;cursor:pointer;
    user-select:none;box-shadow:0 10px 30px rgba(255,46,115,0.4);
    transition: transform .06s;
  }
  .heart:active{transform: scale(0.96);}
  .btn{
    width:100%;padding:12px;border:none;border-radius:12px;
    background:#3a86ff;color:white;font-weight:bold;margin-top:8px;
  }
  .sub{opacity:.85;font-size:14px;line-height:1.5;}
</style>
</head>
<body>

<h2>ğŸ® Love Clicker</h2>

<div class="box">
  <div class="coins">Xu cá»§a báº¡n: <span id="coins">...</span> ğŸ’°</div>
  <div class="sub">
    Cháº¡m vÃ o trÃ¡i tim Ä‘á»ƒ kiáº¿m xu.<br>
    Má»—i 10 tim báº¡n nháº­n 50 xu.
  </div>

  <div class="heart" onclick="tap()">ğŸ’—</div>

  <div style="font-size:18px;margin-top:6px;">
    Tim Ä‘Ã£ cháº¡m: <b id="taps">0</b>
  </div>

  <button class="btn" onclick="claim()">ğŸ Nháº­n thÆ°á»Ÿng</button>
  <p id="msg" style="margin-top:8px;"></p>
</div>

<!-- Firebase -->
<script type="module" src="firebase.js"></script>
<script type="module" src="coins.js"></script>

<script type="module">
  import { auth } from "./firebase.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  import { ensureCoins, addCoins, getCoins } from "./coins.js";

  const coinsEl = document.getElementById("coins");
  const tapsEl = document.getElementById("taps");
  const msgEl = document.getElementById("msg");

  let taps = 0;

  onAuthStateChanged(auth, async (user)=>{
    if(!user){ alert("Báº¡n chÆ°a Ä‘Äƒng nháº­p!"); location.href="login.html"; return; }
    const c = await ensureCoins();
    coinsEl.innerText = c;
  });

  window.tap = () => {
    taps++;
    tapsEl.innerText = taps;
  };

  window.claim = async () => {
    if(taps < 10){
      msgEl.style.color="red";
      msgEl.innerText="ChÆ°a Ä‘á»§ 10 tim Ä‘á»ƒ nháº­n thÆ°á»Ÿng ğŸ˜…";
      return;
    }
    const reward = Math.floor(taps/10) * 50;
    taps = taps % 10; // giá»¯ láº¡i tim dÆ°
    tapsEl.innerText = taps;

    const newCoins = await addCoins(reward);
    coinsEl.innerText = newCoins;

    msgEl.style.color="lightgreen";
    msgEl.innerText = `âœ… Nháº­n ${reward} xu thÃ nh cÃ´ng!`;
  };
</script>

</body>
</html>
