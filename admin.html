<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>NearLove - Admin Reports</title>
<link rel="stylesheet" href="theme.css">
</head>
<body>

<div class="container">
  <h2>üõ°Ô∏è Admin ‚Äî Reports</h2>
  <div id="list"></div>
  <p id="empty" class="muted" style="text-align:center;display:none;">Ch∆∞a c√≥ report n√†o.</p>
</div>

<script type="module" src="firebase.js"></script>
<script src="theme.js"></script>

<script type="module">
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  import {
    collection, query, orderBy, onSnapshot, doc, getDoc, updateDoc
  } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  const listEl=document.getElementById("list");
  const emptyEl=document.getElementById("empty");

  // UID admin c·ªßa b·∫°n (thay b·∫±ng UID th·∫≠t c·ªßa b·∫°n)
  const ADMIN_UIDS = [
    "PUT_YOUR_UID_HERE"
  ];

  onAuthStateChanged(auth, async (user)=>{
    if(!user){ alert("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p!"); location.href="login.html"; return; }

    if(!ADMIN_UIDS.includes(user.uid)){
      alert("B·∫°n kh√¥ng c√≥ quy·ªÅn admin.");
      location.href="index.html";
      return;
    }

    const q=query(collection(db,"reports"), orderBy("createdAt","desc"));

    onSnapshot(q,(snap)=>{
      listEl.innerHTML="";
      if(snap.empty){ emptyEl.style.display="block"; return; }
      emptyEl.style.display="none";

      snap.forEach(d=>{
        const r=d.data();
        const id=d.id;

        const row=document.createElement("div");
        row.className="box fade-in";
        row.style.marginBottom="8px";

        const timeStr=r.createdAt?.toDate
          ? r.createdAt.toDate().toLocaleString()
          : "";

        row.innerHTML=`
          <div style="font-weight:900;font-size:16px;">
            üìå Report: ${r.reason}
          </div>
          <div class="muted" style="margin-top:4px;">
            Reporter: ${r.reporterUid}<br>
            Target: ${r.targetUid}<br>
            Ghi ch√∫: ${r.note||"(kh√¥ng c√≥)"}<br>
            Th·ªùi gian: ${timeStr}<br>
            Tr·∫°ng th√°i: <b>${r.status||"new"}</b>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button class="btn light" data-act="review">ƒêang x·ª≠ l√Ω</button>
            <button class="btn" data-act="done">Xong</button>
          </div>
        `;

        row.querySelectorAll("button").forEach(btn=>{
          btn.onclick=()=>updateStatus(id, btn.dataset.act);
        });

        listEl.appendChild(row);
      });
    });
  });

  async function updateStatus(id, st){
    await updateDoc(doc(db,"reports",id),{status:st});
  }
</script>

</body>
</html>
